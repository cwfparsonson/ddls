_target_: ddls.loops.rllib_epoch_loop.RLlibEpochLoop

# define string path to the model you want to use
path_to_model_cls: ddls.ml_models.policies.GNNPolicy

# define string path to the environment you want to use
#path_to_env_cls: ddls.environments.job_placing.job_placing_all_nodes_environment.JobPlacingAllNodesEnvironment
path_to_env_cls: ddls.environments.ramp_job_placement_shaping.ramp_job_placement_shaping_environment.RampJobPlacementShapingEnvironment

# define string path to the rllib trainer you want to use
path_to_rllib_trainer_cls: ray.rllib.agents.ppo.PPOTrainer

# define the rllib config as usual
rllib_config:
    #env: job_placing_all_nodes_environment
    env: ramp_job_placement_shaping_environment

    env_config:
        node_config:
            type_1:
                num_nodes: 16
                workers_config:
                    #- num_workers: 4
                    - num_workers: 1
                      worker: ddls.devices.processors.gpus.A100.A100

        topology_config:
            #type: torus
            #kwargs:
                #x_dims: 4
                #y_dims: 4
            type: ramp 
            kwargs:
                num_communication_groups: 2
                num_racks_per_communication_group: 2
                num_servers_per_rack: 4
                num_channels: 2
                channel_bandwidth: 1250000000
                switch_reconfiguration_latency: 0.00000125
                worker_io_latency: 0.000000100

        jobs_config:
            #path_to_files: /scratch/datasets/ddls/jobs/tensorflow_synthetic_graphs/valid
            path_to_files: /scratch/datasets/ddls/jobs/pipedream_graphs/image_classification/profiles/alexnet/
            max_files: 1
            job_sampling_mode: remove
            job_interarrival_time_dist:
                _target_: ddls.distributions.uniform.Uniform
                min_val: 1
                max_val: 1000

        #reward_function: mean_job_completion_time
        reward_function: lookahead_job_completion_time

        op_partitioner: sip_ml_op_partitioner
        op_partitioner_kwargs:
            min_op_run_time_quantum: 0.000006 
            max_partitions_per_op: 2

        pad_obs_kwargs:
            max_nodes: 200 

    model:
        fcnet_hiddens:
            - 8
        fcnet_activation: relu
        custom_model: my_model
        custom_model_config:
            in_features_node: 5
            in_features_edge: 2
            out_features_msg: 8
            out_features_hidden: 16
            out_features: 4
            in_features_graph: 15 # 130 34 44 11
            out_features_graph: 4
            num_layers: 2
            aggregator_type: mean
            action_space_type: discrete # discrete continuous

    batch_mode: complete_episodes
    #train_batch_size: 16
    #sgd_minibatch_size: 16
    train_batch_size: 1
    sgd_minibatch_size: 1

    callbacks: ddls.environments.ramp_cluster.utils.RLlibRampClusterEnvironmentCallback

    num_workers: 0 # num parallel cpu workers
    num_gpus: 1 # num gpus available for RLlib

    framework: torch
